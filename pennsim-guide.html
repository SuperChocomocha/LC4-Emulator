<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE>PennSim Guide</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.2  (Win32)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="Paul Gurniak">
	<META NAME="CHANGED" CONTENT="20101008;5081000">
	<META NAME="Originator" CONTENT="Microsoft Word 12">
	<META NAME="ProgId" CONTENT="Word.Document">
	<STYLE TYPE="text/css">
	<!--
		P { color: #000000 }
		H2 { color: #000000 }
		H2.cjk { font-family: "SimSun" }
		H2.ctl { font-family: "Mangal" }
		H3 { color: #000000 }
		H3.cjk { font-family: "SimSun" }
		H3.ctl { font-family: "Mangal" }
		PRE { color: #000000 }
		PRE.cjk { font-family: "NSimSun", monospace }
		A:link { color: #0000ff }
		A:visited { color: #800080 }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#000000" LINK="#0000ff" VLINK="#800080" BGCOLOR="#ffffff" DIR="LTR">
<H2 CLASS="western">PennSim Getting Started Guide 
</H2>
<H3 CLASS="western">1. Getting Started</H3>
<P>PennSim is written in Java, which means Java must be installed on
the computer you plan to use. Java should already be available on all
public SEAS machines. If you plan to work on your personal machine,
you may need to install Java yourself. You can <A HREF="http://java.com/en/download/index.jsp">download
Java here</A>. PennSim requires Java 1.5 or newer (which is available
for Windows, Linux, and Mac OS X).</P>
<P>Throughout this guide, you will see text marked <SPAN STYLE="background: #00ffff">like
this</SPAN>, denoting that the highlighted text is an interaction
with PennSim. If reading the entire guide seems like a tedious task,
you should at least skim the sections where you see highlighted
words.</P>
<H3 CLASS="western">2. Getting the Simulator</H3>
<P>Next, you need to <A HREF="pennsim-dist.html">download the
simulator</A>. <B>Before you do anything else, read the bugs and
notes for the current version</B>. You will probably encounter at
least a few of them when using PennSim. It is distributed in a .jar
file (short for Java ARchive). In Windows or on a Mac, you should be
able to double-click the .jar file to launch the simulator. You can
also launch the simulator from the command line of your operating
system (such as Linux) by using the command java -jar (jarfile). You
should see the simulator screen, much like the screenshot below. To
run it from the Linux labs, type the following command: 
</P>
<PRE CLASS="western" STYLE="margin-bottom: 0.2in"> /usr/java/jdk1.5.0/bin/java -jar ~cis240/public/PennSim.jar</PRE><P>
<A NAME="_x0000_i1025"></A><IMG SRC="pennsim-simulator.png" NAME="graphics1" ALIGN=BOTTOM WIDTH=986 HEIGHT=765 BORDER=0></P>
<P>If you have any problems starting the simulator, please post your
problems to the Blackboard discussion board. This will ensure the
fastest response. 
</P>
<P>We will <B>not</B> be distributing the source to the simulator,
because a later assignment will build parts of the simulator in C
(which is similar to Java in many ways).</P>
<H3 CLASS="western">3. Assembling and Loading your First Program</H3>
<P>Now the simulator is running, but to get it to do anything
interesting, we need to load some software. For later homework
assignments, the first thing you will need to load is an operating
system (OS). This is usually distributed in a separate file from the
user program. For the purposes of this tutorial, however, you only
need to download a <A HREF="counter.asm">single assembly file</A>
(right click-&gt;save as 'counter.asm'). Put this file (and any other
file you wish to use with PennSim) in the same directory as
PennSim.jar. To view and/or edit LC4 assembly, you should use any
<SPAN STYLE="font-weight: normal">plain text editor</SPAN> (read: <B>not
Microsoft Word!</B><SPAN STYLE="font-weight: normal">). Any of the
standard Unix command-line editors would be ideal (Emacs, Vim, etc.),
though on Windows, Notepad is perfectly fine.</SPAN></P>
<P>To help you understand what this basic program does, it is
available here as an assembly language file. A machine, however, does
not interpret assembly language directly: the assembly code must
first be 'assembled' into machine language (a .obj file containing
binary data). PennSim has a built in assembler, accessible via the
Command Line Input box (see above screenshot). <SPAN STYLE="background: #00ffff">To
assemble the counter, enter the following into PennSim's command line
and hit enter</SPAN>:</P>
<P><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">as
counter counter</FONT></FONT></P>
<P>The above line tells PennSim to assemble the contents of
counter[.asm] into machine file counter[.obj]. Note that the file
extensions are implicit: do not include the extension when you wish
to assemble or load files in PennSim. If the assembly completed
without error, you should see the following output. If you do not,
ensure that counter.asm is in the same directory as PennSim.jar.</P>
<P><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">Assembly
completed without errors or warnings.</FONT></FONT></P>
<P>You should now also have the machine code file counter.obj.
Machine files (.obj) contain the machine language encoding of the
assembly language file as well as other information such as labels
(which are not actually used by the machine, but are included for
your convenience). In order to run this, we need to first load it
into memory. Remember that if you are running code that requires an
OS, you need to assemble and load both the code and the OS! <SPAN STYLE="background: #00ffff">To
load the assembled counter into memory, enter the following into the
command line and hit enter</SPAN>:</P>
<P><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">ld
counter</FONT></FONT></P>
<P>The above line tells PennSim to load the contents of counter[.obj]
into memory. As before, the .obj extension is implict: do not include
it in the command line. If the command completed successfully, you
should see the following output:</P>
<P><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">Loading
object file counter.obj: code and data ... symbols ... file and line
numbers ...</FONT></FONT></P>
<P>There should now be instructions visible in the memory viewer
(other than NOP), starting at address x0000. Because PennSim starts
in OS code (address x8200) by default, you will need to scroll the
memory viewer up to see most of the code you just loaded.</P>
<H3 CLASS="western">4. Running Code</H3>
<P>To actually run code, you can use the 4 control buttons at the top
of the simulator, or type commands into the command line interface
(the command names are the same as the buttons). Note that the PC
register is set to x8200, which is the entry point to the operating
system by convention. Usually, the OS will place some preliminary
set-up code here, but in this case, there are just two instructions
that return execution to user code. You do not need to worry about
what goes here (this will usually be provided for you); just scroll
the Memory viewer so that address x8200 is visible.</P>
<P>There are four different ways to run code (each of the four
buttons labeled &ldquo;Next&rdquo;, &ldquo;Step&rdquo;, &ldquo;Continue&rdquo;,
and &ldquo;Finish&rdquo;). We will walk through how to use three of
these four (Next, Step, and Continue).</P>
<H3 CLASS="western">4a. Step</H3>
<P>Before doing anything, notice that the current PC (address x8200,
CONST R7, #0) is highlighted in <SPAN STYLE="background: #ffff00">yellow</SPAN>.
The instruction that is highlighted will be the next one executed (as
opposed to the one that was just executed). Clicking <SPAN STYLE="background: #00ffff">Step</SPAN>
will cause PennSim to execute a single instruction. <SPAN STYLE="background: #00ffff">Do
this once</SPAN>. You will notice that the value in the PC register
will increase to x8201, and the highlighted instruction will move
down to address x8201, which is RTI. Now, click <SPAN STYLE="background: #00ffff">Step</SPAN>
again. The RTI will return execution to user code, where the counter
is located. Observe how Step allows us to inspect the execution of a
program instruction-by-instruction. Now that we are in user code,
click <SPAN STYLE="background: #00ffff">Step</SPAN> twice more. You
should see the value of R1 change to 1 (CONST R1, #1).</P>
<P>Now, notice how the currently highlighted instruction is a JSR.
Because the label information is included in the .obj file, this
reads JSR INCREMENT. Observe how there is also a label INCREMENT in
place of address x0010; when we execute the next instruction, we will
move &ldquo;into&rdquo; the function INCREMENT. Press <SPAN STYLE="background: #00ffff">Step</SPAN>
once to do this. Notice that two things changed: the PC changed to
0x0010 (the location of label INCREMENT), and the value of R7 changed
to 0x0003. These details are important later in the course when you
will be writing assembly to call and return from functions.</P>
<P>To complete execution of the INCREMENT function, hit <SPAN STYLE="background: #00ffff">Step</SPAN>
twice. The value of R0 will be increased by 1, and then the PC will
return to the line after the function call (x0003). Because this next
instruction is an unconditional jump back to the function call, you
can keep pressing <SPAN STYLE="background: #00ffff">Step</SPAN>, and
the value of R0 will continue to increase as increment is called and
returns. Do this a few times, until you are bored of watching R0
increase.</P>
<H3 CLASS="western">4b. Next</H3>
<P>Instead of using Step to execute instructions, we can also use
Next. To clearly see the difference between Next and Step, click <SPAN STYLE="background: #00ffff">Step</SPAN>
a few times until the current PC is x0002 (label INFINITE_LOOP,
instruction JSR INCREMENT). Remember that before, when we hit Step
from this location, we &ldquo;stepped&rdquo; into the function
INCREMENT, one single instruction at a time. Before hitting Next,
make a note of the value of R0. Now, hit <SPAN STYLE="background: #00ffff">Next</SPAN>.
The PC has moved to the &ldquo;next&rdquo; instruction, x0003. But,
the value of R0 has also increased (which means that INCREMENT was
executed). What happened here is that PennSim continued execution to
the next instruction, executing everything inside a function without
pausing. Do this a few times until you can see the difference between
<SPAN STYLE="background: #00ffff">Next</SPAN> and <SPAN STYLE="background: #00ffff">Step</SPAN>
(perhaps run through INCREMENT using Step again). Next is useful if
you wish to debug a function, and you know every call made by that
function is bug-free.</P>
<P>You should also notice that the INCREMENT function increases the
value of R0 by R1. This means that if we increase R1, we will change
the rate at which R0 increases. To manually change the value in a
register while code is running, <SPAN STYLE="background: #00ffff">type
the following command in the command line and hit enter</SPAN>:</P>
<P><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">set
R1 2</FONT></FONT></P>
<P>The above line sets the value of the specified register to the
provided value. Values should be specified in decimal (either
positive or negative will work). Now try using <SPAN STYLE="background: #00ffff">Next</SPAN>
a few more times. You will see the value of R0 increase by 2 for each
function call. Note that manually setting values should not be relied
on in finished code (that you submit for an assignment), but it can
be useful for debugging.</P>
<H3 CLASS="western">4c. Continue and Stop</H3>
<P>As you may have noticed from the tedium of the previous two
examples, it can take a very long time to run through a program using
Step and Next. It may be more useful to just let a program go and see
if it does what it's supposed to: to do this, hit <SPAN STYLE="background: #00ffff">Continue</SPAN>.
This tells PennSim to keep executing instructions without pause until
something bad happens or you hit Stop. Notice how quickly the value
of R0 cycles through. Once you have seen enough of R0 rolling over
from negative to positive, hit <SPAN STYLE="background: #00ffff">Stop</SPAN>
to pause execution where it is.</P>
<H3 CLASS="western">4d. Breakpoints</H3>
<P>For the purposes of debugging, it may seem like Next and Step are
too slow, while Continue runs way too quickly to be useful. Luckily,
there is a middle ground: breakpoints. A breakpoint is set at a
particular memory location, and tells the simulator to stop execution
upon reaching that point. Memory locations with breakpoints set on
them show up in the simulator with a check mark in the &quot;BP&quot;
column, and the address is highlighted in red. It is left as an
exercise to the reader to determine what &quot;BP&quot; stands for.
You can set a breakpoint at a memory location with the command <FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">break
set (label)</FONT></FONT>, or by checking the checkbox in the &quot;BP&quot;
column. You can get rid of a previously-set breakpoint with the
command <FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">break
clear (memory location)</FONT></FONT>, or by un-checking a previously
checked box. You can also set and clear breakpoints at labels,
instead of specifying a hex memory location.</P>
<P>When you tell the simulator to continue, it will only run until it
hits a breakpoint (or the system halts or has an error). Try adding a
<SPAN STYLE="background: #00ffff">breakpoint</SPAN> to label
INFINITE_LOOP (address x0002). If this was done correctly, the line
of the memory viewer containing INFINITE_LOOP will turn <SPAN STYLE="background: #ff3333">red</SPAN>.
Now hit <SPAN STYLE="background: #00ffff">continue</SPAN>. You will
notice that every time you hit continue, the value of R0 will
increase by R1, and you will get a notification in the command line
output that a breakpoint was reached.</P>
<P>Breakpoints are not a PennSim-specific feature; they are an
important feature of almost any debugger (read: <B>GDB</B>). When you
are writing code in assembly that is more involved than the counter
demo, breakpoints will prove very useful.</P>
<H3 CLASS="western">5. Running Scripts</H3>
<P>A lot of the commands used to assemble, load, and test code can
get repetitive; to prevent needlessly entering the same commands
after every minor debugging attempt, PennSim has the ability to load
a &ldquo;script file&rdquo; containing a series of commands that are
then executed. The script files just plain text (they can have any
file extension, but you <B>must include the extension when using the
script command</B>). If you open the script file with a text editor,
you can see that the script commands are the same as those you type
at the command line. For repetitive tasks, using a script file can
save you time, and perhaps the lifelong agony of <A HREF="http://en.wikipedia.org/wiki/Repetitive_stress_syndrome">Repetitive
Strain Injury</A>. 
</P>
<P>Scripting is also a great way of testing your code. You can write
a few test cases and check your code easily. We provide a <A HREF="setup.txt"><SPAN STYLE="font-weight: normal">sample
script here</SPAN></A> (right click-&gt;save as) that does everything
you just did (assembling and loading counter.asm, changing R1,
setting a breakpoint, and then running once). <SPAN STYLE="background: #00ffff">To
run this script, enter the following command</SPAN>:</P>
<P><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">script
setup.txt</FONT></FONT></P>
<P>You can now press <SPAN STYLE="background: #00ffff">Continue</SPAN>
as many times as you would like to add 2 to R0. Who ever said PennSim
can't be fun?</P>
<H3 CLASS="western">6. General Help and Advice</H3>
<P>This document doesn't cover all of the simulator's functionality;
for an extended discussion of usage see the <A HREF="pennsim-manual.html">PennSim
Manual</A>. For quick help within the simulator itself, you can use
the help command to see a list of all of PennSim's commands. Use help
(command) to get help on a specific command. 
</P>
<P>Many of the PennSim commands have shortcuts - b is short for
break, n for next, and so forth. Use the help (or h) command to see
what shortcuts exist. 
</P>
<P>The PennSim Command Line has a history feature - use the up and
down arrow keys to go backwards and forwards through the commands
you've previously entered. 
</P>
<P>If you resize the simulator window to make it bigger, the
Commandline Output Pane will grow. If you have a small screen and the
Commandline Output Pane still isn't big enough, you can open an
external, resizable Command Output Window by selecting the Open
Command Output Window option from the File menu. This lets you see a
lot more output from the commands you run, and is particularly useful
for viewing the errors the assembler generates. 
</P>
<P>If you have trouble running the simulator, try checking the class
forum (the Blackboard discussion board) in case someone else has had
the same problem as you. The forum is checked regularly. Of course,
you can also email cis240@seas, or drop by office hours. 
</P>
<P>If you think you've found a bug in the simulator (which is,
theoretically speaking, a possibility:), check the <A HREF="pennsim-dist.html">Simulator
distribution/bugs page</A> to see if you've found a known bug with a
workaround. If you've found a new bug, email cis240@seas (if you're
feeling kinder). Be sure to include the following: 
</P>
<OL>
	<LI><P STYLE="margin-bottom: 0in">A description of the bug. 
	</P>
	<LI><P STYLE="margin-bottom: 0in">What you were doing that caused
	the bug to occur. 
	</P>
	<LI><P STYLE="margin-bottom: 0in">What version of the simulator you
	were using. Find this via the simulator's About menu. 
	</P>
	<LI><P STYLE="margin-bottom: 0in">What version of Java you were
	using. Find this by running java -version from the commandline of
	your OS. 
	</P>
	<LI><P>What operating system you were using - Windows, Linux, Mac. 
	</P>
</OL>
<P>Also look in the directory where you placed the simulator and
check for a file called &quot;pennsim_errorlog.txt&quot;, and email
it to cis240@seas. This file is a stack trace generated on some
errors, which may help us figure out how to fix the bug. It contains
no sensitive system information - it's in plain text, so you can see
what it is that you're sending us. 
</P>
</BODY>
</HTML>